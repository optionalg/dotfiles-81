#!/bin/sh
#
# wildefyr - 2016 (c) CC
# produce my bar information

. fyrerc

test $SW -ge 1920 && {
    SIZE=${SIZE-35}
} || {
    SIZE=${SIZE-30}
}

FULL=${FULL-▪}
EMPTY=${EMPTY-▬}
ACTIVE="%{F#D7D7D7}"
INACTIVE="%{F#737373}"
whiteSpace=$(printf '%s' " ")

draw() {
    perc=$1
    size=$2

    inc=$((perc * size / 100))

    for v in $(seq 0 $((size - 1))); do
        test $v -le $inc && {
            out="${out}${FULL}"
        } || {
            out="${out}${EMPTY}"
        }
    done

    printf '%s' "$out"
}

string="${string}%{l}"

globalvolume=$(amixer get Master 2> /dev/null | sed -n 's/^.*\[\([0-9]\+\)%.*$/\1/p')
globalvolume=$(draw $globalvolume $SIZE)
cputemp=$(cpu t)
cputemp=$(draw $cputemp $SIZE)

string="${string}${whiteSpace}${whiteSpace}${ACTIVE}\
%{A4:amixer -c 0 set Master 2db+ unmute -q:}\
%{A5:amixer -c 0 set Master 2db- unmute -q:}\
${globalvolume}  ${cputemp}\
%{A}%{A}"

string="${string}%{r}"

dateFormat=$(date '+%d %b %T')

string="${string}${ACTIVE}\
${dateFormat}${whiteSpace}${whiteSpace}"

printf '%s\n' "${string}"
