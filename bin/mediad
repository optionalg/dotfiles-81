#!/bin/sh
#
# wildefyr - 2016 (c) wtfpl
# wrapper for viewing media from the web

ARGS="$@"

usage() {
    printf '%s\n' "Usage: $(basename $0) <urls>"
    test -z $1 || exit $1
}

main() {
    MEDIADIR=${IMAGEDIR:-/tmp/media}
    FILES="$@"

    test ! -d $MEDIADIR && mkdir -p $MEDIADIR

    for file in $FILES; do
        case $1 in
            *pub.iotek.org/*)
                fileLocation=$MEDIADIR/$(printf '%s' $file | cut -d/ -f 5) ;;
            *i.imgur.com*)
                fileLocation=$MEDIADIR/$(printf '%s' $file | cut -d/ -f 4) ;;
            *)
                fileLocation=$MEDIADIR/latest ;;
        esac

        wget "$file" -O "$fileLocation" -q
        mpv --really-quiet --loop-file "$fileLocation"
    done
}

main $ARGS
