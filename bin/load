#!/bin/sh
#
# wildefyr - 2016 (c) wtfpl
# link load with extra tweaks for wmutils
# with thanks to z3bra for the idea

URL="$1"

rawp() {
    case "$URL" in
        *paste.lisp.org/*)
            URL="$(echo $URL)/raw"
            ;;
        *pastebin.com/*)
            URL="http://pastebin.com/raw/$(echo $URL | cut -d/ -f 4)"
            ;;
        *pbin.in/*)
            URL="http://pbin.in/raw/$(echo $URL | cut -d/ -f 4)"
            ;;
        *paste.list.org/*)
            URL="http://paste.lisp.org/display/$(echo $URL | cut -d/ -f 4)/raw"
            ;;
    esac
}

openBrowser() {
    test ! -z $(wid 'chrome') && {
        google-chrome-stable --new-tab "$URL" 2> /dev/null
    } || {
        windows -s 2
        google-chrome-stable --new-tab "$URL" 2> /dev/null
    }

    focus "$(wid 'chrome')"
}

# sync clipboards
printf '%s\n' "$URL" | xsel -pi
printf '%s\n' "$URL" | xsel -si
printf '%s\n' "$URL" | xsel -bi

case "$URL" in
    *.gifv|*.webm)
        exec mpv "$URL" --really-quiet --loop-file &
        ;;
    *.jp*g|*.png|*.webm|*.gif|*gfycat.com/*)
        mediad "$URL"
        ;;
    *imgur.com/a/?????*)
        openBrowser
        ;;
    *imgur.com/???????*)
        URL=$(printf '%s\n' "${URL}.png")
        mediad "$URL"
        ;;
    *.mkv|*.mp4|*.ogv|*youtube.com/watch*|*youtu.be/*|*.googlevideo.com/videoplayback*)
        exec mpv "$URL" --really-quiet &
        ;;
    *twitch.tv/*)
        livestreamer "$URL" source -Q
        ;;
    gopher://*)
        urxvt -e cgo "$URL"
        ;;
    *paste.lisp.org/*|*pastebin.com/raw*|*pbin.in/*)
        rawp
        urxvt -name "paste" -e zsh -i -c "curl -s '$URL' | $EDITOR -"
        ;;
    *.txt|*ix.io/*|*p.iotek.org/*|*sprunge.us/*|*bpaste.net/*|*pastebin.com*|*pbin.in/raw*)
        urxvt -name "paste" -e zsh -i -c "curl -s '$URL' | $EDITOR -"
        ;;
    *)
        openBrowser
        ;;
esac
